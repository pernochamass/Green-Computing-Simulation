<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Computing Power Manager - Group 40</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icon Components
        const Power = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M12 2v10M18.4 6.6a9 9 0 1 1-12.77.04"/>
            </svg>
        );
        
        const Cpu = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="4" y="4" width="16" height="16" rx="2"/>
                <rect x="9" y="9" width="6" height="6"/>
                <path d="M15 2v2M15 20v2M9 2v2M9 20v2M2 15h2M2 9h2M20 15h2M20 9h2"/>
            </svg>
        );
        
        const HardDrive = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M22 12H2M22 12l-2.45-6.55A2 2 0 0 0 17.67 4H6.33a2 2 0 0 0-1.88 1.45L2 12m20 0v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-6"/>
                <circle cx="6" cy="15" r="1"/>
            </svg>
        );
        
        const Monitor = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="2" y="3" width="20" height="14" rx="2"/>
                <path d="M8 21h8M12 17v4"/>
            </svg>
        );
        
        const Wifi = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M5 13a10 10 0 0 1 14 0M8.5 16.5a5 5 0 0 1 7 0"/>
                <circle cx="12" cy="20" r="1"/>
            </svg>
        );
        
        const Battery = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="2" y="7" width="16" height="10" rx="2"/>
                <path d="M22 11v2"/>
            </svg>
        );
        
        const TrendingDown = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M23 18l-9.5-9.5-5 5L1 6"/>
                <path d="M17 18h6v-6"/>
            </svg>
        );
        
        const Activity = ({size = 24, className = ""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
        );

        const GreenComputingPowerManager = () => {
            const [isRunning, setIsRunning] = useState(false);
            const [time, setTime] = useState(0);
            const [autoMode, setAutoMode] = useState(true);
            const [backendConnected, setBackendConnected] = useState(false);
            
            const [components, setComponents] = useState({
                cpu: { state: 'P0', utilization: 0, power: 65, temp: 45 },
                ram: { state: 'Active', power: 8, utilization: 0 },
                disk: { state: 'Active', power: 7, lastAccess: 0 },
                display: { state: 'On', power: 25, brightness: 100 },
                network: { state: 'Active', power: 3, traffic: 0 }
            });
            
            const [powerHistory, setPowerHistory] = useState([]);
            const [totalEnergy, setTotalEnergy] = useState(0);
            const [energySaved, setEnergySaved] = useState(0);
            const [logs, setLogs] = useState([]);
            
            const API_URL = 'http://localhost:5000/api';
            
            const cpuPowerStates = {
                'P0': { power: 65, freq: '3.5 GHz', performance: 100 },
                'P1': { power: 45, freq: '2.5 GHz', performance: 70 },
                'P2': { power: 25, freq: '1.5 GHz', performance: 40 },
                'P3': { power: 10, freq: '0.8 GHz', performance: 20 },
                'C1': { power: 5, freq: 'Sleep', performance: 0 },
                'C3': { power: 1, freq: 'Deep Sleep', performance: 0 }
            };
            
            const fetchBackendData = async () => {
                try {
                    const response = await fetch(`${API_URL}/status`);
                    if (response.ok) {
                        const data = await response.json();
                        setBackendConnected(true);
                        setComponents(data.components);
                        setPowerHistory(data.power_history);
                        setTotalEnergy(data.total_energy);
                        setEnergySaved(data.energy_saved);
                        setLogs(data.logs);
                        setAutoMode(data.auto_mode);
                        setIsRunning(data.is_running);
                    } else {
                        setBackendConnected(false);
                    }
                } catch (error) {
                    setBackendConnected(false);
                }
            };
            
            const sendControl = async (action) => {
                try {
                    const response = await fetch(`${API_URL}/control`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action })
                    });
                    if (response.ok) {
                        await fetchBackendData();
                    }
                } catch (error) {
                    console.error('Control error:', error);
                }
            };
            
            const generateReport = async () => {
                try {
                    const response = await fetch(`${API_URL}/report`);
                    if (response.ok) {
                        const report = await response.json();
                        alert(`üìä Energy Report

Runtime: ${report.runtime_seconds}s
Total Energy: ${report.total_energy_wh} Wh
Energy Saved: ${report.energy_saved_wh} Wh
Efficiency: ${report.efficiency_percent}%
Average Power: ${report.average_power_w} W

Generated: ${report.generated_at}`);
                    }
                } catch (error) {
                    alert('‚ùå Could not generate report. Make sure backend is running.');
                }
            };
            
            useEffect(() => {
                fetchBackendData();
                const interval = setInterval(() => {
                    if (isRunning) {
                        setTime(t => t + 1);
                    }
                    fetchBackendData();
                }, 1000);
                
                return () => clearInterval(interval);
            }, [isRunning]);
            
            const getTotalPower = () => {
                return Object.values(components).reduce((sum, comp) => sum + comp.power, 0);
            };
            
            const ComponentCard = ({ icon: Icon, name, data, color }) => (
                <div className="bg-white rounded-lg p-4 shadow-sm border-l-4" style={{borderLeftColor: color}}>
                    <div className="flex items-center gap-2 mb-3">
                        <Icon size={20} className="text-gray-600" />
                        <span className="font-semibold text-gray-700">{name}</span>
                    </div>
                    <div className="space-y-1 text-sm">
                        {Object.entries(data).map(([key, value]) => (
                            <div key={key} className="flex justify-between">
                                <span className="text-gray-500 capitalize">{key}:</span>
                                <span className="font-medium text-gray-800">{value}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                <Battery className="text-green-600" size={36} />
                                <h1 className="text-4xl font-bold text-gray-800">Green Computing Power Manager</h1>
                            </div>
                            <p className="text-gray-600">Group 40 - Intelligent Power Management System</p>
                            <div className="mt-2">
                                {backendConnected ? (
                                    <span className="text-green-600 font-semibold">‚óè Backend Connected</span>
                                ) : (
                                    <span className="text-red-600 font-semibold">‚óè Backend Disconnected - Run: python power_backend.py</span>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex flex-wrap items-center gap-4">
                                <button
                                    onClick={() => sendControl(isRunning ? 'stop' : 'start')}
                                    disabled={!backendConnected}
                                    className={`px-6 py-2 rounded-lg font-semibold ${
                                        isRunning 
                                        ? 'bg-red-500 hover:bg-red-600' 
                                        : 'bg-green-500 hover:bg-green-600'
                                    } text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed`}
                                >
                                    {isRunning ? 'Pause' : 'Start'} Monitoring
                                </button>
                                <button
                                    onClick={() => sendControl('reset')}
                                    disabled={!backendConnected}
                                    className="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
                                >
                                    Reset
                                </button>
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        checked={autoMode}
                                        onChange={() => sendControl('toggle_auto')}
                                        disabled={!backendConnected}
                                        className="w-4 h-4"
                                    />
                                    <span className="font-medium text-gray-700">Adaptive Power Management</span>
                                </label>
                                <button
                                    onClick={generateReport}
                                    disabled={!backendConnected}
                                    className="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
                                >
                                    Generate Report
                                </button>
                                <div className="ml-auto text-right">
                                    <div className="text-2xl font-bold text-gray-800">{time}s</div>
                                    <div className="text-sm text-gray-500">Runtime</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white">
                                <div className="flex items-center gap-2 mb-2">
                                    <Activity size={24} />
                                    <span className="font-semibold">Current Power</span>
                                </div>
                                <div className="text-3xl font-bold">{getTotalPower().toFixed(1)} W</div>
                            </div>
                            <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-6 text-white">
                                <div className="flex items-center gap-2 mb-2">
                                    <Power size={24} />
                                    <span className="font-semibold">Total Energy</span>
                                </div>
                                <div className="text-3xl font-bold">{totalEnergy.toFixed(2)} Wh</div>
                            </div>
                            <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white">
                                <div className="flex items-center gap-2 mb-2">
                                    <TrendingDown size={24} />
                                    <span className="font-semibold">Energy Saved</span>
                                </div>
                                <div className="text-3xl font-bold">{energySaved.toFixed(2)} Wh</div>
                            </div>
                            <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white">
                                <div className="flex items-center gap-2 mb-2">
                                    <Battery size={24} />
                                    <span className="font-semibold">Efficiency</span>
                                </div>
                                <div className="text-3xl font-bold">
                                    {totalEnergy > 0 ? ((energySaved / (totalEnergy + energySaved)) * 100).toFixed(0) : 0}%
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Component Status</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <ComponentCard 
                                    icon={Cpu} 
                                    name="CPU" 
                                    color="#3b82f6"
                                    data={{
                                        'State': components.cpu.state,
                                        'Frequency': components.cpu.frequency || 'N/A',
                                        'Utilization': `${components.cpu.utilization}%`,
                                        'Power': `${components.cpu.power} W`,
                                        'Temperature': `${components.cpu.temp}¬∞C`
                                    }}
                                />
                                <ComponentCard 
                                    icon={Activity} 
                                    name="RAM" 
                                    color="#10b981"
                                    data={{
                                        'State': components.ram.state,
                                        'Utilization': `${components.ram.utilization}%`,
                                        'Power': `${components.ram.power} W`
                                    }}
                                />
                                <ComponentCard 
                                    icon={HardDrive} 
                                    name="Disk" 
                                    color="#f59e0b"
                                    data={{
                                        'State': components.disk.state,
                                        'Power': `${components.disk.power} W`,
                                        'Last Access': `${components.disk.lastAccess.toFixed(1)}s`
                                    }}
                                />
                                <ComponentCard 
                                    icon={Monitor} 
                                    name="Display" 
                                    color="#8b5cf6"
                                    data={{
                                        'State': components.display.state,
                                        'Brightness': `${components.display.brightness}%`,
                                        'Power': `${components.display.power} W`
                                    }}
                                />
                                <ComponentCard 
                                    icon={Wifi} 
                                    name="Network" 
                                    color="#ec4899"
                                    data={{
                                        'State': components.network.state,
                                        'Power': `${components.network.power} W`
                                    }}
                                />
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Power Consumption Timeline</h2>
                            <div className="h-48 flex items-end gap-1">
                                {powerHistory.map((power, i) => (
                                    <div 
                                        key={i} 
                                        className="flex-1 bg-gradient-to-t from-blue-500 to-blue-300 rounded-t"
                                        style={{height: `${(power / 120) * 100}%`}}
                                        title={`${power.toFixed(1)}W`}
                                    />
                                ))}
                            </div>
                            <div className="flex justify-between text-sm text-gray-500 mt-2">
                                <span>0W</span>
                                <span>120W (Max)</span>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Activity Log</h2>
                            <div className="space-y-2 max-h-64 overflow-y-auto">
                                {logs.length === 0 ? (
                                    <p className="text-gray-500 text-center py-4">No activity yet. Start monitoring to see logs.</p>
                                ) : (
                                    logs.map((log, i) => (
                                        <div key={i} className={`p-3 rounded text-sm ${
                                            log.type === 'success' ? 'bg-green-50 text-green-800' :
                                            log.type === 'warning' ? 'bg-yellow-50 text-yellow-800' :
                                            'bg-blue-50 text-blue-800'
                                        }`}>
                                            <span className="font-semibold">{log.timestamp}</span> - {log.message}
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-6 mt-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">üí° How It Works</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div className="border-l-4 border-blue-500 pl-4">
                                    <h3 className="font-bold text-gray-700 mb-2">1. CPU P-States (Performance)</h3>
                                    <p className="text-gray-600">Adjusts CPU voltage and frequency based on workload. High load = P0 (3.5 GHz), Low load = P3 (0.8 GHz).</p>
                                </div>
                                <div className="border-l-4 border-green-500 pl-4">
                                    <h3 className="font-bold text-gray-700 mb-2">2. CPU C-States (Idle)</h3>
                                    <p className="text-gray-600">Puts CPU to sleep when idle (&lt;10% utilization), saving up to 60W of power.</p>
                                </div>
                                <div className="border-l-4 border-orange-500 pl-4">
                                    <h3 className="font-bold text-gray-700 mb-2">3. Disk Spin-down</h3>
                                    <p className="text-gray-600">Spins down hard drive after 20s of inactivity, reducing power from 7W to 2W.</p>
                                </div>
                                <div className="border-l-4 border-purple-500 pl-4">
                                    <h3 className="font-bold text-gray-700 mb-2">4. Display Brightness</h3>
                                    <p className="text-gray-600">Dims screen to 50% during low activity, cutting display power from 25W to 12W.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GreenComputingPowerManager />);
    </script>
</body>
</html>